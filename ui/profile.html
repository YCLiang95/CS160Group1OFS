<!doctype html>
<html>
   <head>
      <meta charset="utf-8">
      <link href="eCommerceAssets/styles/profile.css" rel="stylesheet" type="text/css">
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">
      <title>profile Page</title>
   </head>
   <body onLoad="load()">
      <p><a id="welcomeMessage">A placeholder for account profile page.</a></p>
      <div class="mainContent">
         <div class = "buttons">	
            <button id="inventoryButton" onClick="toInventoryManagement()">Manage Inventory</button><br>
            <button id="returnButton" onClick="window.location.href=`index.html`"><i class="fas fa-home"></i>Return Home</button><br>
            <button id="logoutButton" onClick="logout()"><i class="fas fa-sign-out-alt"></i>Logout</button><br>         
         </div>
		  <form id="userForm" method="post" accept-charset="UTF-8">
			  <input type="number" name="uid" value = "48">
			  <input type="number" name="count" value = "10">
			  <input type="number" name="page" value = "1">
	      </form>
         <div class="orderHistory">
            <h3>Order History</h3>
            <div id="historyList">
				  <ul>
                  <li>
                     11/7/2018<span> order Status </span>
                     <p>order number</p>
                  </li>
               </ul>
            </div>
         </div>
      </div>
      <script>
         var username = "";
         
		  function load(){
			  getUserName();
			  getOrderList();
		  }
		  
         function getOrderList(){
         	var orderList = [];
			// var form = document.createElement("form");
			//var form = document.querySelector('form');
  			//var data = new FormData(form);
			//var data = {uid: 48, page: 1, count: 10};
			//data.append("uid", getCookie("UID"));
			
			//data.append('uid', 48);
			//data.append('page', 1);
			//data.append('count', 10);
			 //var re = {content: data};
			 var data = new FormData(document.getElementById("userForm"));
         	var xhttp = new XMLHttpRequest();
         	xhttp.onreadystatechange = function() {
         		if (this.readyState == 4 && this.status == 200) {
         			var s = JSON.parse(this.responseText);
         			if (s.code == 200){
						productList = s.data;
         			} else alert(s.message);
         		}	
         	};
         	xhttp.open("POST", "http://47.254.94.78:8085/cs160/user/order/getOrders", false);
			//xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
			//console.log("uid="+ getCookie("UID") + "&page=1&count=10");
			 xhttp.send(data);
         	//xhttp.send("uid="+ getCookie("UID") + "&page=1&count=10"); 
			 //orderList.push({order: {create_time: "11/19/2018", oid: 123, status: 1}});
			 console.log(orderList.length);
			var list = document.getElementById("historyList");
         	for (var i = 0; i < orderList.length; i ++){
         		var container = `
			    <ul>
                  <li>
                     <a>${orderList[i].order.create_time}</a><span> ${orderList[i].order.status = 0 ? "In transit" : "Delivered"} </span>
                     <p>${orderList[i].order.oid}</p>
                  </li>
               </ul>`;
				var template = document.createElement("template");
         		template.innerHTML = container;
         		list.appendChild(template.content);
			}
         }
         
         function toInventoryManagement(){
         	if (username == "admin"){
         		window.location.href = "inventory.html";
         	} else {
         		alert("Sorry, this is for employees only.");	
         	}
         }
		  
		 function getCookie(cookieName){
         	var name = cookieName + "=";
           		var cookie = document.cookie.split(';');
           		for(var i = 0; i < cookie.length; i++) {
               		var entry = cookie[i];
         		entry.replace(/ /g,'');
               		if (entry.indexOf(name) >= 0) {
                   		return entry.substring(entry.indexOf(name) + name.length, entry.length);
         		}
         	}
           		return "";
         }
         
         function getUserName(){
			username = getCookie("userName");
         	document.getElementById("welcomeMessage").innerHTML = username + "'s profile page."
         }
         
         function logout(){
         	document.cookie="userName=;" + "expires=Thu, 01 Jan 1970 00:00:01 GMT" ;
         	location.href="index.html";
         }
      </script>
   </body>
</html>